generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Country {
  id        Int        @id @default(autoincrement())
  nameEn    String     @map("name_en") @db.VarChar(100)
  nameBn    String?    @map("name_bn") @db.VarChar(100)
  nameAr    String?    @map("name_ar") @db.VarChar(100)
  code      String     @unique @db.VarChar(3)
  divisions Division[]
  users     User[]

  @@map("countries")
}

model Division {
  id        Int        @id @default(autoincrement())
  countryId Int        @map("country_id")
  nameEn    String     @map("name_en") @db.VarChar(100)
  nameBn    String?    @map("name_bn") @db.VarChar(100)
  nameAr    String?    @map("name_ar") @db.VarChar(100)
  districts District[]
  country   Country    @relation(fields: [countryId], references: [id])
  users     User[]

  @@index([countryId])
  @@map("divisions")
}

model District {
  id         Int      @id @default(autoincrement())
  divisionId Int      @map("division_id")
  nameEn     String   @map("name_en") @db.VarChar(100)
  nameBn     String?  @map("name_bn") @db.VarChar(100)
  nameAr     String?  @map("name_ar") @db.VarChar(100)
  latitude   Decimal? @db.Decimal(10, 8)
  longitude  Decimal? @db.Decimal(11, 8)
  division   Division @relation(fields: [divisionId], references: [id])
  users      User[]

  @@index([divisionId])
  @@index([latitude, longitude])
  @@map("districts")
}

model User {
  id                Int                @id @default(autoincrement())
  email             String             @unique @db.VarChar(255)
  name              String             @db.VarChar(100)
  phone             String?            @db.VarChar(20)
  image             String?            @db.Text
  countryId         Int?               @map("country_id")
  divisionId        Int?               @map("division_id")
  districtId        Int?               @map("district_id")
  preferredLanguage String             @default("en") @map("preferred_language") @db.VarChar(5)
  timezone          String             @default("Asia/Dhaka") @db.VarChar(50)
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  cityName          String?            @default("Dhaka") @map("city_name") @db.VarChar(100)
  countryName       String?            @default("Bangladesh") @map("country_name") @db.VarChar(100)
  lastActiveAt      DateTime?          @map("last_active_at")
  lastLoginAt       DateTime?          @map("last_login_at")
  emailVerified     Boolean            @default(false) @map("email_verified")
  passwordHash      String?            @map("password_hash") @db.Text
  accounts          Account[]
  completedDeeds    CompletedDeed[]
  leaderboards      LeaderboardCache[]
  prayerSettings    PrayerSettings?
  pushSubscriptions PushSubscription[]
  goals             UserGoal[]
  country           Country?           @relation(fields: [countryId], references: [id])
  district          District?          @relation(fields: [districtId], references: [id])
  division          Division?          @relation(fields: [divisionId], references: [id])

  @@index([email])
  @@index([countryId, divisionId, districtId])
  @@index([districtId], map: "users_district_id_fkey")
  @@index([divisionId], map: "users_division_id_fkey")
  @@map("users")
}

model VerificationToken {
  id        Int      @id @default(autoincrement())
  email     String   @db.VarChar(255)
  token     String   @unique @db.VarChar(255)
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([email])
  @@map("verification_tokens")
}

model Account {
  id                String  @id @default(cuid())
  userId            Int     @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId], map: "accounts_user_id_fkey")
  @@map("accounts")
}

model PredefinedGoodDeed {
  id                  Int             @id @default(autoincrement())
  nameEn              String          @map("name_en") @db.VarChar(100)
  nameBn              String?         @map("name_bn") @db.VarChar(100)
  nameAr              String?         @map("name_ar") @db.VarChar(100)
  category            String          @default("other") @db.VarChar(50)
  tier                String          @default("easy") @db.VarChar(20)
  points              Int             @default(10)
  timeEstimateMinutes Int?            @map("time_estimate_minutes")
  icon                String?         @db.VarChar(50)
  isActive            Boolean         @default(true) @map("is_active")
  displayOrder        Int             @default(0) @map("display_order")
  descriptionEn       String?         @map("description_en") @db.Text
  descriptionBn       String?         @map("description_bn") @db.Text
  descriptionAr       String?         @map("description_ar") @db.Text
  categoryAr          String?         @map("category_ar") @db.VarChar(100)
  categoryBn          String?         @map("category_bn") @db.VarChar(100)
  categoryEn          String?         @map("category_en") @db.VarChar(100)
  completedDeeds      CompletedDeed[]
  goals               UserGoal[]

  @@map("predefined_good_deeds")
}

model UserGoal {
  id             Int                 @id @default(autoincrement())
  userId         Int                 @map("user_id")
  goodDeedId     Int?                @map("good_deed_id")
  customDeedName String?             @map("custom_deed_name") @db.VarChar(200)
  goalType       String              @map("goal_type") @db.VarChar(20)
  targetCount    Int                 @default(1) @map("target_count")
  startDate      DateTime            @map("start_date") @db.Date
  endDate        DateTime            @map("end_date") @db.Date
  isCompleted    Boolean             @default(false) @map("is_completed")
  createdAt      DateTime            @default(now()) @map("created_at")
  goodDeed       PredefinedGoodDeed? @relation(fields: [goodDeedId], references: [id])
  user           User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, goalType, startDate])
  @@index([goodDeedId], map: "user_goals_good_deed_id_fkey")
  @@map("user_goals")
}

model CompletedDeed {
  id             Int                 @id @default(autoincrement())
  userId         Int                 @map("user_id")
  goodDeedId     Int?                @map("good_deed_id")
  customDeedName String?             @map("custom_deed_name") @db.VarChar(200)
  basePoints     Int                 @default(10) @map("base_points")
  bonusPoints    Int                 @default(0) @map("bonus_points")
  multiplier     Decimal             @default(1.00) @db.Decimal(3, 2)
  totalPoints    Int                 @map("total_points")
  completedAt    DateTime            @default(now()) @map("completed_at")
  date           DateTime            @db.Date
  notes          String?             @db.Text
  isStreakBonus  Boolean             @default(false) @map("is_streak_bonus")
  isPowerDay     Boolean             @default(false) @map("is_power_day")
  goodDeed       PredefinedGoodDeed? @relation(fields: [goodDeedId], references: [id])
  user           User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([date])
  @@index([goodDeedId], map: "completed_deeds_good_deed_id_fkey")
  @@map("completed_deeds")
}

model LeaderboardCache {
  id          Int      @id @default(autoincrement())
  userId      Int      @map("user_id")
  period      String   @db.VarChar(20)
  scopeType   String   @map("scope_type") @db.VarChar(20)
  scopeId     Int?     @map("scope_id")
  totalPoints Int      @default(0) @map("total_points")
  rank        Int?
  date        DateTime @db.Date
  lastUpdated DateTime @default(now()) @updatedAt @map("last_updated")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, period, scopeType, scopeId, date])
  @@index([period, scopeType, scopeId, rank])
  @@map("leaderboard_cache")
}

model PrayerSettings {
  id                  Int     @id @default(autoincrement())
  userId              Int     @unique @map("user_id")
  calculationMethod   String  @default("Karachi") @map("calculation_method") @db.VarChar(20)
  juristicMethod      String  @default("Hanafi") @map("juristic_method") @db.VarChar(20)
  enableNotifications Boolean @default(true) @map("enable_notifications")
  user                User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("prayer_settings")
}

model SystemSettings {
  id               Int      @id @default(autoincrement())
  slackWebhookUrl  String?  @map("slack_webhook_url") @db.Text
  notifyOnRegister Boolean  @default(true) @map("notify_on_register")
  notifyOnLogin    Boolean  @default(true) @map("notify_on_login")
  notifyOnVisit    Boolean  @default(false) @map("notify_on_visit")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@map("system_settings")
}

model PushSubscription {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  token     String   @unique @db.VarChar(512)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("push_subscriptions")
}

model GoldSilverPrice {
  id             Int      @id @default(autoincrement())
  goldPer22KGram Decimal  @map("gold_per_22k_gram") @db.Decimal(12, 2)
  goldPer24KGram Decimal  @map("gold_per_24k_gram") @db.Decimal(12, 2)
  goldPer21KGram Decimal  @map("gold_per_21k_gram") @db.Decimal(12, 2)
  goldPer18KGram Decimal  @map("gold_per_18k_gram") @db.Decimal(12, 2)
  silverPerGram  Decimal  @map("silver_per_gram") @db.Decimal(10, 2)
  currency       String   @default("BDT") @db.VarChar(5)
  source         String   @default("BAJUS") @db.VarChar(50)
  isManual       Boolean  @default(false) @map("is_manual")
  fetchedAt      DateTime @default(now()) @map("fetched_at")

  @@map("gold_silver_prices")
}
